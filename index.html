<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Polska Quest â€” Road to B1 (Expanded, v5)</title>
<style>
:root{
  --bg:#0b1220; --panel:#0f182a; --ink:#e6eefb; --muted:#a3b1c6; --border:#172338;
  --accent:#22c55e; --accent2:#06b6d4; --warn:#eab308; --bad:#ef4444;
  --btn:#132036; --btn2:#182a46; --glow:0 10px 30px rgba(0,0,0,.35);
}
*{box-sizing:border-box}
html,body{height:100%}
body{margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; background:
 radial-gradient(1400px 800px at 10% -10%, #16263f 0%, #0b1220 60%), var(--bg); color:var(--ink); letter-spacing:.2px}
a{color:#9ad1ff}
.app{max-width:1120px; margin:18px auto 110px; padding:0 16px}
header{display:flex; gap:16px; align-items:center; flex-wrap:wrap}
.h1{font-weight:800; font-size: clamp(20px, 3.3vw, 34px)}
.tag{padding:6px 10px; border:1px solid var(--border); border-radius:999px; background:linear-gradient(to bottom,#0f192b,#0c1627); color:#cbd5e1; font-weight:700}
.controls{margin-left:auto; display:flex; gap:8px; align-items:center}
.btn{background:var(--btn); color:var(--ink); border:1px solid var(--border); padding:10px 14px; border-radius:10px; font-weight:700; cursor:pointer}
.btn:hover{background:var(--btn2)}
.btn.small{padding:6px 10px; font-size:13px}
.grid{display:grid; gap:16px; grid-template-columns: repeat(auto-fit, minmax(250px,1fr))}
.card{background:linear-gradient(180deg,#0f182a,#0b1322); border:1px solid var(--border); border-radius:16px; padding:18px; box-shadow:var(--glow); position:relative; overflow:visible}
.progress{height:10px; border-radius:999px; background:#0b1322; border:1px solid var(--border); overflow:hidden}
.progress>div{height:100%; width:0%; background:linear-gradient(90deg, var(--accent), var(--accent2))}
.row{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
.subtle{color:#a3b1c6; font-weight:700; font-size:12px; letter-spacing:.3px}
.h2{font-weight:800; font-size: clamp(18px, 2.4vw, 24px); margin:4px 0 6px}
.h3{font-weight:800; font-size: clamp(16px, 2.2vw, 20px); margin:0 0 6px}
.kbd{background:#0d1423; padding:2px 6px; border-radius:6px; border:1px solid var(--border); font-weight:700}
.pill{background:#0f1726; border:1px solid var(--border); padding:6px 10px; border-radius:999px; font-weight:700; color:#cbd5e1; display:inline-block; margin:2px; word-break:keep-all}
.badge{border:1px solid var(--border); padding:2px 8px; border-radius:8px; font-weight:800}
.primary{color:#12df8f}
.warning{color:#ffdb70}
.danger{color:#ff8b8b}
input[type="text"], textarea{width:100%; background:#0f1726; color:var(--ink); border:1px solid var(--border); border-radius:10px; padding:10px 12px; font-size:16px}
textarea{min-height:130px; resize:vertical}
.choice{padding:12px; background:#0f1726; border:1px solid var(--border); border-radius:12px; font-weight:700; cursor:pointer; text-align:left; display:block; width:100%}
.choice.correct{outline:2px solid var(--accent)}
.choice.wrong{outline:2px solid var(--bad)}
.list{display:grid; gap:10px}
.center{text-align:center}
footer.fixed{position:fixed; inset:auto 0 0 0; background:rgba(10,16,28,.85); backdrop-filter: blur(8px); border-top:1px solid var(--border)}
footer .inner{max-width:1120px; margin:0 auto; padding:12px 16px; display:flex; align-items:center; justify-content:space-between; gap:12px; color:#cbd5e1}
hr{border:none; height:1px; background:linear-gradient(90deg,#0e1726,#253a63); margin:12px 0}
.hidden{display:none}
.lock{position:absolute; inset:0; background:rgba(7,10,18,.68); border-radius:16px; border:1px dashed #2b3b5d; display:flex; align-items:center; justify-content:center; text-align:center; padding:14px; z-index:2}
.level-banner{margin:18px 0 8px; padding:8px 12px; border:1px solid var(--border); border-radius:12px; background:linear-gradient(180deg, #0f192c, #0c1526); font-weight:800}

/* Ensure options never get cut off on mobile */
.card .list{max-height:70vh; overflow:auto; padding-right:4px}
.sticky-ops{position:sticky; top:0; display:flex; gap:8px; padding:8px 0; background:linear-gradient(180deg, rgba(11,18,32,.98), rgba(11,18,32,.75)); z-index:3; border-bottom:1px solid var(--border)}
.topbar{display:flex; gap:8px; align-items:center; justify-content:space-between; margin-bottom:8px}
</style>

<link rel="manifest" href="manifest.webmanifest">
<meta name="theme-color" content="#0b1220">
<link rel="icon" href="icons/icon-192.png" sizes="192x192">
<link rel="apple-touch-icon" href="icons/icon-192.png">

</head>
<body>
<div class="app" id="app">
  <header>
    <div class="h1">Polska Quest â€” <span class="subtle">Road to B1 (Expanded, v5)</span></div>
    <span class="tag">A1 â†’ A2 â†’ B1 progression (locked until completed)</span>
    <div class="controls">
      <button class="btn small" id="muteBtn">ğŸ”Š Audio on</button>
      <button class="btn small" id="resetBtn">ğŸ—‘ï¸ Reset</button>
    </div>
    <div style="width:100%">
      <div class="progress"><div id="xpBar"></div></div>
      <div class="row">
        <div class="pill">XP: <b id="xp">0</b></div>
        <div class="pill">Units done: <b id="done">0</b>/18</div>
        <div class="pill">Streak: <b id="streak">0</b> days</div>
        <div class="pill">Level: <b id="lvl">A1</b></div>
      </div>
    </div>
  </header>

  <div id="screen"></div>
</div>

<footer class="fixed">
  <div class="inner tiny">
    <div>Tip: Tap ğŸ”ˆ for Polish audio. Use <span class="kbd">Enter</span> to submit. You can always <b>Skip</b> a question and use ğŸ  Home.</div>
    <div><button class="btn small" id="reviewBtn">ğŸ“š Spaced Review</button>
    <button class="btn small" id="examBtn">ğŸ“ B1 Mock Exam</button></div>
  </div>
</footer>

<script>
// ===== Voice =====
const voice = { muted:false, voice:null, ready:false };
function loadVoices(){ const vs = speechSynthesis.getVoices(); voice.voice = vs.find(v=>/pl-PL/i.test(v.lang)) || vs.find(v=>v.lang&&v.lang.startsWith('pl')) || vs[0] || null; voice.ready=true; setMuteLabel(); }
if('speechSynthesis' in window){ speechSynthesis.onvoiceschanged = loadVoices; loadVoices(); }
function speak(t){ if(voice.muted || !('speechSynthesis' in window)) return; const u=new SpeechSynthesisUtterance(t); if(voice.voice) u.voice=voice.voice; u.lang=(voice.voice&&voice.voice.lang)||'pl-PL'; u.rate=.95; speechSynthesis.cancel(); speechSynthesis.speak(u); }
function soundBtn(text){ const b=document.createElement('button'); b.className='btn small'; b.textContent='ğŸ”ˆ'; b.onclick=e=>{e.stopPropagation(); speak(text);}; return b; }
function setMuteLabel(){ document.getElementById('muteBtn').textContent = voice.muted ? 'ğŸ”‡ Audio off' : 'ğŸ”Š Audio on'; }
document.getElementById('muteBtn').onclick=()=>{ voice.muted=!voice.muted; setMuteLabel(); };

// ===== Save =====
const SAVE_KEY='PQ_B1_SAVE_V5';
const Save = {
  data: { xp:0, unitsDone:{}, review:[], streak:0, lastDay:null },
  load(){ try{ const x=JSON.parse(localStorage.getItem(SAVE_KEY)||'null'); if(x) this.data=x; }catch(e){} updateHUD(); },
  save(){ localStorage.setItem(SAVE_KEY, JSON.stringify(this.data)); updateHUD(); },
  addXP(n){ this.data.xp += n; if(this.data.xp<0) this.data.xp=0; this.save(); },
  markUnit(id){ this.data.unitsDone[id]=true; this.save(); },
  pushReview(card){ this.data.review.push(card); if(this.data.review.length>500) this.data.review.shift(); this.save(); },
  touchStreak(){ const today = new Date().toISOString().slice(0,10); if(this.data.lastDay!==today){ this.data.streak += 1; this.data.lastDay=today; } this.save(); }
};
function updateHUD(){
  const doneCount = Object.keys(Save.data.unitsDone).length;
  document.getElementById('xp').textContent = Save.data.xp;
  document.getElementById('done').textContent = doneCount + '/18';
  document.getElementById('streak').textContent = Save.data.streak;
  const stage = doneCount>=12 ? 'B1' : doneCount>=6 ? 'A2' : 'A1';
  document.getElementById('lvl').textContent = stage;
  const pct = Math.min(100, Math.round((doneCount/18)*100));
  document.getElementById('xpBar').style.width = pct+'%';
}

// ===== Data =====
const COURSE = [{"id": 1, "level": "A1", "title": "Greetings & Introductions", "topics": ["politeness", "names", "formal/informal"], "vocab": [["czeÅ›Ä‡", "hi"], ["siema", "hey"], ["hej", "hi"], ["dzieÅ„ dobry", "good morning/day"], ["dobry wieczÃ³r", "good evening"], ["dobranoc", "good night"], ["do widzenia", "goodbye"], ["na razie", "see you"], ["do zobaczenia", "see you later"], ["dziÄ™kujÄ™", "thank you"], ["dziÄ™kujÄ™ bardzo", "thank you very much"], ["proszÄ™", "please / youâ€™re welcome"], ["przepraszam", "sorry / excuse me"], ["nie ma za co", "donâ€™t mention it"], ["miÅ‚o mi", "nice to meet you"], ["jak masz na imiÄ™?", "whatâ€™s your name?"], ["mam na imiÄ™â€¦", "my name isâ€¦"], ["nazywam siÄ™â€¦", "my name isâ€¦"], ["skÄ…d jesteÅ›?", "where are you from?"], ["jestem zâ€¦", "Iâ€™m fromâ€¦"], ["jak siÄ™ masz?", "how are you?"], ["w porzÄ…dku", "fine"], ["tak", "yes"], ["nie", "no"], ["rozumiem", "I understand"], ["nie rozumiem", "I donâ€™t understand"], ["proszÄ™ powtÃ³rzyÄ‡", "please repeat"], ["mÃ³wiÄ™ po polsku", "I speak Polish"], ["trochÄ™", "a little"], ["ile masz lat?", "how old are you?"], ["mam â€¦ lat", "I am â€¦ years old"], ["co u ciebie?", "howâ€™s it going?"], ["wszystko dobrze", "all good"]], "grammar": "<b>Register:</b> Use <i>pan/pani</i> for polite forms; introduce yourself with <i>Nazywam siÄ™â€¦</i>.", "dialogues": [{"npc": "Pani Ewa", "q": "CzeÅ›Ä‡! Jak masz na imiÄ™?", "answers": [["CzeÅ›Ä‡, jestem Adam.", 1], ["Mam dwa lata.", 0], ["Do widzenia!", 0]]}, {"npc": "Pani Ewa", "q": "DziÄ™kujÄ™ za pomoc!", "answers": [["ProszÄ™ bardzo!", 1], ["Przepraszam.", 0], ["Nie.", 0]]}, {"npc": "Nowa osoba", "q": "SkÄ…d jesteÅ›?", "answers": [["Jestem z Hiszpanii.", 1], ["Mam na imiÄ™ poniedziaÅ‚ek.", 0], ["Nie rozumiem.", 0]]}]}, {"id": 2, "level": "A1", "title": "Numbers, Colors & Food Shopping", "topics": ["numbers", "colors", "shop"], "vocab": [["zero", "zero"], ["jeden", "one"], ["dwa", "two"], ["trzy", "three"], ["cztery", "four"], ["piÄ™Ä‡", "five"], ["szeÅ›Ä‡", "six"], ["siedem", "seven"], ["osiem", "eight"], ["dziewiÄ™Ä‡", "nine"], ["dziesiÄ™Ä‡", "ten"], ["jedenaÅ›cie", "eleven"], ["dwanaÅ›cie", "twelve"], ["trzynaÅ›cie", "thirteen"], ["czternaÅ›cie", "fourteen"], ["piÄ™tnaÅ›cie", "fifteen"], ["szesnaÅ›cie", "sixteen"], ["siedemnaÅ›cie", "seventeen"], ["osiemnaÅ›cie", "eighteen"], ["dziewiÄ™tnaÅ›cie", "nineteen"], ["dwadzieÅ›cia", "twenty"], ["biaÅ‚y", "white"], ["czarny", "black"], ["szary", "gray"], ["brÄ…zowy", "brown"], ["czerwony", "red"], ["zielony", "green"], ["niebieski", "blue"], ["Å¼Ã³Å‚ty", "yellow"], ["pomaraÅ„czowy", "orange"], ["fioletowy", "purple"], ["rÃ³Å¼owy", "pink"], ["chleb", "bread"], ["buÅ‚ka", "roll"], ["masÅ‚o", "butter"], ["ser", "cheese"], ["mleko", "milk"], ["jajko", "egg"], ["szynka", "ham"], ["jabÅ‚ko", "apple"], ["banan", "banana"], ["pomidor", "tomato"], ["ogÃ³rek", "cucumber"], ["ziemniaki", "potatoes"], ["kawa", "coffee"], ["herbata", "tea"], ["sok", "juice"], ["woda gazowana", "sparkling water"], ["paragon", "receipt"], ["karta", "card"], ["gotÃ³wka", "cash"], ["Ile to kosztuje?", "How much is it?"], ["poproszÄ™â€¦", "Iâ€™d likeâ€¦"], ["czy jest promocja?", "is there a discount?"], ["tani", "cheap"], ["drogi", "expensive"]], "grammar": "<b>Ordering:</b> <i>PoproszÄ™ + accusative</i> â€” PoproszÄ™ kawÄ™ / wodÄ™ / chleb.", "dialogues": [{"npc": "Sprzedawca", "q": "W czym mogÄ™ pomÃ³c?", "answers": [["PoproszÄ™ chleb i wodÄ™.", 1], ["Mam jabÅ‚ko.", 0], ["Nie wiem.", 0]]}, {"npc": "Sprzedawca", "q": "To kosztuje piÄ™Ä‡ zÅ‚otych.", "answers": [["DziÄ™kujÄ™.", 1], ["Ile masz lat?", 0], ["Czerwony!", 0]]}, {"npc": "Kasjer", "q": "PÅ‚aci pan kartÄ… czy gotÃ³wkÄ…?", "answers": [["KartÄ…, proszÄ™.", 1], ["Tak, jabÅ‚ko.", 0], ["Nie ma sprawy.", 0]]}]}, {"id": 3, "level": "A1", "title": "Family & Descriptions", "topics": ["family", "adjectives", "appearance"], "vocab": [["mama", "mother"], ["tata", "father"], ["rodzice", "parents"], ["siostra", "sister"], ["brat", "brother"], ["babcia", "grandmother"], ["dziadek", "grandfather"], ["ciocia", "aunt"], ["wujek", "uncle"], ["kuzyn", "cousin (m.)"], ["kuzynka", "cousin (f.)"], ["mÄ…Å¼", "husband"], ["Å¼ona", "wife"], ["syn", "son"], ["cÃ³rka", "daughter"], ["dziecko", "child"], ["rodzina", "family"], ["wysoki", "tall (m.)"], ["niski", "short (m.)"], ["szczupÅ‚y", "slim (m.)"], ["gruby", "overweight (m.)"], ["Å‚adna", "pretty (f.)"], ["przystojny", "handsome (m.)"], ["miÅ‚a", "nice (f.)"], ["miÅ‚y", "nice (m.)"], ["wÅ‚osy", "hair"], ["blond", "blond"], ["brunet", "brunette (m.)"], ["szatyn", "brownâ€‘haired (m.)"], ["siwe wÅ‚osy", "gray hair"], ["oczy", "eyes"], ["niebieskie oczy", "blue eyes"], ["zielone oczy", "green eyes"], ["brÄ…zowe oczy", "brown eyes"]], "grammar": "<b>Agreement:</b> Adjectives agree: <i>wysoki chÅ‚opak / Å‚adna dziewczyna</i>.", "dialogues": [{"npc": "Znajomy", "q": "Opisz swojÄ… rodzinÄ™, proszÄ™.", "answers": [["Mam brata i siostrÄ™.", 1], ["Mam dworzec.", 0], ["Czerwony kot.", 0]]}, {"npc": "KoleÅ¼anka", "q": "Jak wyglÄ…da twÃ³j brat?", "answers": [["Jest wysoki i ma niebieskie oczy.", 1], ["Jest godzina Ã³sma.", 0], ["LubiÄ™ jabÅ‚ka.", 0]]}]}, {"id": 4, "level": "A1", "title": "Daily Routines & Present Tense", "topics": ["habits", "time of day", "present tense"], "vocab": [["budzÄ™ siÄ™", "I wake up"], ["wstajÄ™", "I get up"], ["myjÄ™ siÄ™", "I wash"], ["biorÄ™ prysznic", "I take a shower"], ["jem Å›niadanie", "I eat breakfast"], ["idÄ™ do pracy", "I go to work"], ["jadÄ™ do pracy", "I go to work (by transport)"], ["pracujÄ™", "I work"], ["uczÄ™ siÄ™", "I study"], ["robiÄ™ zakupy", "I do the shopping"], ["wracam do domu", "I come back home"], ["gotujÄ™ obiad", "I cook lunch/dinner"], ["sprzÄ…tam", "I clean"], ["odpoczywam", "I rest"], ["oglÄ…dam serial", "I watch a series"], ["czytam ksiÄ…Å¼kÄ™", "I read a book"], ["rozmawiam z przyjacielem", "I talk with a friend"], ["spotykam siÄ™", "I meet up"], ["Ä‡wiczÄ™", "I exercise"], ["biegnÄ™", "I run"], ["idÄ™ spaÄ‡", "I go to sleep"], ["Å›piÄ™", "I sleep"], ["w weekend", "on the weekend"], ["zazwyczaj", "usually"], ["czasami", "sometimes"]], "grammar": "<b>Present endings:</b> <i>-m, -sz, -Ã˜/-e; -my, -cie, -Ä…</i>; some verbs irregular.", "dialogues": [{"npc": "Kolega", "q": "O ktÃ³rej wstajesz?", "answers": [["WstajÄ™ o siÃ³dmej.", 1], ["IdÄ™ jutro.", 0], ["Czytam ksiÄ…Å¼kÄ™.", 0]]}, {"npc": "KoleÅ¼anka", "q": "Co robisz po pracy?", "answers": [["GotujÄ™ i odpoczywam.", 1], ["ByÅ‚em w pracy.", 0], ["PojadÄ™ jutro.", 0]]}]}, {"id": 5, "level": "A1", "title": "Time, Dates & Appointments", "topics": ["days", "months", "clock", "appointments"], "vocab": [["poniedziaÅ‚ek", "Monday"], ["wtorek", "Tuesday"], ["Å›roda", "Wednesday"], ["czwartek", "Thursday"], ["piÄ…tek", "Friday"], ["sobota", "Saturday"], ["niedziela", "Sunday"], ["dziÅ› / dzisiaj", "today"], ["jutro", "tomorrow"], ["pojutrze", "the day after tomorrow"], ["wczoraj", "yesterday"], ["przedwczoraj", "the day before yesterday"], ["godzina", "hour"], ["kwadrans", "quarter"], ["wpÃ³Å‚ do", "half to"], ["za piÄ™Ä‡", "five to"], ["po", "past"], ["termin", "appointment/date"], ["umÃ³wiÄ‡ siÄ™", "to make an appointment"], ["kalendarz", "calendar"], ["przeÅ‚oÅ¼yÄ‡", "to reschedule"], ["odwoÅ‚aÄ‡", "to cancel"], ["wolny", "free"], ["zajÄ™ty", "busy"], ["styczeÅ„", "January"], ["luty", "February"], ["marzec", "March"], ["kwiecieÅ„", "April"], ["maj", "May"], ["czerwiec", "June"], ["lipiec", "July"], ["sierpieÅ„", "August"], ["wrzesieÅ„", "September"], ["paÅºdziernik", "October"], ["listopad", "November"], ["grudzieÅ„", "December"]], "grammar": "<b>Questions:</b> <i>KtÃ³ra jest godzina?</i> / <i>Kiedy masz spotkanie?</i>.", "dialogues": [{"npc": "Sekretariat", "q": "Kiedy pasuje spotkanie?", "answers": [["Jutro o dziesiÄ…tej.", 1], ["Wczoraj o dziesiÄ…tej.", 0], ["Na dworcu.", 0]]}, {"npc": "Recepcja", "q": "Czy moÅ¼emy przeÅ‚oÅ¼yÄ‡ termin?", "answers": [["Tak, na poniedziaÅ‚ek.", 1], ["Mam dworzec.", 0], ["Czerwony kot.", 0]]}]}, {"id": 6, "level": "A1", "title": "Travel Basics & Directions", "topics": ["tickets", "maps", "places", "navigation"], "vocab": [["lewo", "left"], ["prawo", "right"], ["prosto", "straight"], ["skrÄ™Ä‡", "turn"], ["skrzyÅ¼owanie", "intersection"], ["na rogu", "on the corner"], ["przystanek", "bus stop"], ["rozkÅ‚ad jazdy", "timetable"], ["dworzec", "station"], ["peron", "platform"], ["ulica", "street"], ["plac", "square"], ["mapa", "map"], ["blisko", "near"], ["daleko", "far"], ["lotnisko", "airport"], ["samolot", "airplane"], ["bilet", "ticket"], ["bilet dobowy", "day ticket"], ["kasa biletowa", "ticket office"], ["autobus", "bus"], ["tramwaj", "tram"], ["metro", "metro"], ["autostrada", "highway"], ["zjazd", "exit"], ["na pÃ³Å‚noc", "to the north"], ["na poÅ‚udnie", "to the south"], ["na wschÃ³d", "to the east"], ["na zachÃ³d", "to the west"], ["spÃ³Åºniony", "delayed"], ["odjazd", "departure"], ["przyjazd", "arrival"]], "grammar": "<b>Prepositions:</b> <i>na + locative</i> (na dworcu), <i>w + locative</i> (w mieÅ›cie).", "dialogues": [{"npc": "Policjant", "q": "Gdzie jest dworzec?", "answers": [["Prosto i w prawo.", 1], ["Mam bilet.", 0], ["Niebieski dom.", 0]]}, {"npc": "Turysta", "q": "KtÃ³ry peron do Krakowa?", "answers": [["Peron trzeci.", 1], ["Wczoraj rano.", 0], ["Do widzenia!", 0]]}]}, {"id": 7, "level": "A2", "title": "Past Tense â€” Telling Stories", "topics": ["yesterday", "weekend", "narration"], "vocab": [["wczoraj", "yesterday"], ["tydzieÅ„ temu", "a week ago"], ["miesiÄ…c temu", "a month ago"], ["w zeszÅ‚ym roku", "last year"], ["poszedÅ‚em/poszÅ‚am", "I went (on foot)"], ["pojechaÅ‚em/pojechaÅ‚am", "I went (by transport)"], ["wrÃ³ciÅ‚em/wrÃ³ciÅ‚am", "I came back"], ["kupiÅ‚em/kupiÅ‚am", "I bought"], ["zjadÅ‚em/zjadÅ‚am", "I ate"], ["wypiÅ‚em/wypiÅ‚am", "I drank"], ["oglÄ…daÅ‚em/oglÄ…daÅ‚am", "I watched"], ["czytaÅ‚em/czytaÅ‚am", "I read (past)"], ["spotkaÅ‚em/spotkaÅ‚am", "I met"], ["odwiedziÅ‚em/odwiedziÅ‚am", "I visited"], ["uczyÅ‚em siÄ™/uczyÅ‚am siÄ™", "I studied"], ["odpoczywaÅ‚em/odpoczywaÅ‚am", "I rested"], ["sprzÄ…taÅ‚em/sprzÄ…taÅ‚am", "I cleaned"], ["zrobiÅ‚em/zrobiÅ‚am zakupy", "I did the shopping"], ["spÃ³ÅºniÅ‚em/spÃ³ÅºniÅ‚am siÄ™", "I was late"], ["zgubiÅ‚em/zgubiÅ‚am", "I lost"], ["pÃ³Åºno", "late"], ["wczeÅ›nie", "early"], ["najpierwâ€¦ potemâ€¦", "firstâ€¦ thenâ€¦"], ["w koÅ„cu", "finally"]], "grammar": "<b>Past:</b> gender agreement: <i>kupiÅ‚em (m.), kupiÅ‚am (f.)</i>.", "dialogues": [{"npc": "Znajomy", "q": "Co robiÅ‚eÅ› wczoraj?", "answers": [["ByÅ‚em w kinie i kupiÅ‚em popcorn.", 1], ["BÄ™dÄ™ w kinie.", 0], ["IdÄ™ do kina.", 0]]}, {"npc": "Kolega", "q": "Kiedy wrÃ³ciÅ‚aÅ› do domu?", "answers": [["WrÃ³ciÅ‚am pÃ³Åºno, o jedenastej.", 1], ["Wracam jutro.", 0], ["Nie wiem.", 0]]}]}, {"id": 8, "level": "A2", "title": "Accusative â€” Objects in Action", "topics": ["objects", "ordering", "direct objects"], "vocab": [["widzÄ™ psa", "I see a dog"], ["mam kota", "I have a cat"], ["pijÄ™ kawÄ™", "I drink coffee"], ["pijÄ™ wodÄ™", "I drink water"], ["jem zupÄ™", "I eat soup"], ["jem kanapkÄ™", "I eat a sandwich"], ["czytam ksiÄ…Å¼kÄ™", "I read a book"], ["piszÄ™ eâ€‘mail", "I write an email"], ["oglÄ…dam film", "I watch a movie"], ["zwiedzam miasto", "I tour the city"], ["kupujÄ™ bilet", "I buy a ticket"], ["noszÄ™ kurtkÄ™", "I wear a jacket"], ["kocham muzykÄ™", "I love music"], ["lubiÄ™ sport", "I like sport"], ["sÅ‚yszÄ™ muzykÄ™", "I hear music"], ["odwiedzam muzeum", "I visit a museum"], ["gotujÄ™ kolacjÄ™", "I cook dinner"], ["sprzÄ…tam mieszkanie", "I clean the apartment"], ["zamawiam pizzÄ™", "I order pizza"], ["bierzesz parasol?", "are you taking an umbrella?"], ["proszÄ™ kawÄ™", "coffee, please"], ["poproszÄ™ rachunek", "the bill, please"], ["otwieram okno", "I open the window"], ["zamykam drzwi", "I close the door"]], "grammar": "<b>Accusative:</b> masculine animate â†’ <i>-a</i> (pies â†’ psa); after many verbs: widzieÄ‡, mieÄ‡, lubiÄ‡, jeÅ›Ä‡, piÄ‡.", "dialogues": [{"npc": "KtoÅ›", "q": "Co pijesz?", "answers": [["PijÄ™ wodÄ™.", 1], ["PijÄ™ woda.", 0], ["Mam woda.", 0]]}, {"npc": "Kelner", "q": "Co zamawiasz?", "answers": [["Zamawiam zupÄ™ i saÅ‚atkÄ™.", 1], ["IdÄ™ do muzeum.", 0], ["ByÅ‚em w pracy.", 0]]}]}, {"id": 9, "level": "A2", "title": "Genitive â€” Negation & Quantities", "topics": ["negation", "amounts", "containers"], "vocab": [["nie mam czasu", "I donâ€™t have time"], ["nie mam pieniÄ™dzy", "I donâ€™t have money"], ["nie ma problemu", "no problem"], ["duÅ¼o pracy", "a lot of work"], ["maÅ‚o czasu", "little time"], ["trochÄ™ cukru", "a bit of sugar"], ["wiele ludzi", "many people"], ["butelka wina", "a bottle of wine"], ["szklanka wody", "a glass of water"], ["kubek herbaty", "a cup of tea"], ["kilogram jabÅ‚ek", "a kilo of apples"], ["pÃ³Å‚ kilo sera", "half a kilo of cheese"], ["para butÃ³w", "a pair of shoes"], ["paczka ciastek", "a pack of cookies"], ["bez cukru", "without sugar"], ["obok domu", "next to the house"], ["naprzeciw szkoÅ‚y", "opposite the school"], ["blisko centrum", "near the center"], ["daleko miasta", "far from the city"], ["sÅ‚ucham muzyki", "I listen to music"], ["szukam pracy", "Iâ€™m looking for a job"], ["potrzebujÄ™ pomocy", "I need help"], ["nie lubiÄ™ haÅ‚asu", "I donâ€™t like noise"], ["nie ma miejsca", "there is no space"]], "grammar": "<b>Genitive:</b> after negation, quantity words, some prepositions (<i>bez, obok, naprzeciw, blisko, daleko</i>).", "dialogues": [{"npc": "Kolega", "q": "Masz czas?", "answers": [["Niestety nie mam czasu.", 1], ["Mam czasu.", 0], ["Mam czasem.", 0]]}, {"npc": "Sprzedawca", "q": "Ile chcesz jabÅ‚ek?", "answers": [["Kilogram jabÅ‚ek, proszÄ™.", 1], ["JabÅ‚ko jest czerwone.", 0], ["Nie wiem.", 0]]}]}, {"id": 10, "level": "A2", "title": "Dative â€” Giving & Telling", "topics": ["recipient", "benefit", "pronouns"], "vocab": [["dajÄ™ mamie prezent", "I give mom a gift"], ["kupujÄ™ bratu prezent", "I buy a gift for my brother"], ["pomagam koledze", "I help a friend (m.)"], ["pomagam koleÅ¼ance", "I help a friend (f.)"], ["dziÄ™kujÄ™ panu", "I thank you (sir)"], ["dziÄ™kujÄ™ pani", "I thank you (madam)"], ["radzÄ™ koledze", "I advise a friend"], ["opowiadam dzieciom", "I tell children"], ["pokazujÄ™ babci zdjÄ™cia", "I show grandma photos"], ["Å¼yczÄ™ ci powodzenia", "I wish you good luck"], ["wierzÄ™ tobie", "I believe you"], ["podaj mi sÃ³l", "pass me the salt"], ["smakuje mi zupa", "I like the soup (it tastes good to me)"], ["boli mnie gÅ‚owa", "my head hurts"], ["przeszkadza mi haÅ‚as", "noise bothers me"], ["miÅ‚o mi panu pomÃ³c", "Iâ€™m happy to help you (sir)"], ["naleÅ¼y do ciebie", "it belongs to you"], ["pomagam sÄ…siadom", "I help neighbors"], ["gratulujÄ™ przyjacielowi", "I congratulate a friend"], ["odpowiadam nauczycielce", "I answer the (female) teacher"]], "grammar": "<b>Dative:</b> komu? czemu? Used with <i>pomagaÄ‡, dziÄ™kowaÄ‡, mÃ³wiÄ‡, radziÄ‡, wierzyÄ‡</i>; also with idioms (<i>smakuje mi</i>).", "dialogues": [{"npc": "Ty", "q": "Komu dziÄ™kujesz?", "answers": [["DziÄ™kujÄ™ pani Kasi.", 1], ["DziÄ™kujÄ™ Kasia.", 0], ["DziÄ™kujÄ™ pan.", 0]]}, {"npc": "Mama", "q": "Komu dajesz prezent?", "answers": [["DajÄ™ bratu.", 1], ["DajÄ™ brat.", 0], ["DajÄ™ bratowi dom.", 0]]}]}, {"id": 11, "level": "A2", "title": "Instrumental â€” With/As & Professions", "topics": ["with", "profession", "interests"], "vocab": [["z przyjacielem", "with a friend (m.)"], ["z przyjaciÃ³Å‚kÄ…", "with a friend (f.)"], ["z rodzinÄ…", "with family"], ["jestem studentem", "I am a student (m.)"], ["jestem studentkÄ…", "I am a student (f.)"], ["jestem nauczycielem", "I am a teacher (m.)"], ["jestem lekarkÄ…", "I am a doctor (f.)"], ["jestem inÅ¼ynierem", "I am an engineer (m.)"], ["jestem kierowcÄ…", "I am a driver (m.)"], ["interesujÄ™ siÄ™ sportem", "Iâ€™m interested in sports"], ["interesujÄ™ siÄ™ muzykÄ…", "Iâ€™m interested in music"], ["interesujÄ™ siÄ™ historiÄ…", "Iâ€™m interested in history"], ["jestem wegetarianinem", "Iâ€™m a vegetarian (m.)"], ["idÄ™ z psem", "Iâ€™m going with the dog"], ["piszÄ™ dÅ‚ugopisem", "I write with a pen"], ["nad morzem z rodzinÄ…", "at the seaside with family"], ["pracujÄ™ z zespoÅ‚em", "I work with a team"], ["jestem menedÅ¼erem", "I am a manager (m.)"], ["jestem sprzedawcÄ…", "I am a salesperson (m.)"], ["jestem artystkÄ…", "I am an artist (f.)"], ["jestem programistÄ…", "I am a programmer (m.)"]], "grammar": "<b>Instrumental:</b> after <i>z</i> (with) and professions after <i>byÄ‡</i>. Endings: <i>-em/-Ä…</i>.", "dialogues": [{"npc": "Nowy znajomy", "q": "Kim jesteÅ› z zawodu?", "answers": [["Jestem inÅ¼ynierem.", 1], ["Jestem inÅ¼ynier.", 0], ["ByÅ‚em inÅ¼ynierem jutro.", 0]]}, {"npc": "KtoÅ›", "q": "Czym piszesz?", "answers": [["PiszÄ™ dÅ‚ugopisem.", 1], ["PiszÄ™ dÅ‚ugopis.", 0], ["PiszÄ™ ksiÄ…Å¼kÄ™.", 0]]}]}, {"id": 12, "level": "A2", "title": "Locative â€” Places & Housing", "topics": ["home", "rooms", "city", "after prepositions"], "vocab": [["w domu", "at home"], ["w pracy", "at work"], ["w szkole", "at school"], ["na uniwersytecie", "at the university"], ["w kuchni", "in the kitchen"], ["w Å‚azience", "in the bathroom"], ["w salonie", "in the living room"], ["w sypialni", "in the bedroom"], ["w Warszawie", "in Warsaw"], ["w Krakowie", "in Krakow"], ["na poczcie", "at the post office"], ["na lotnisku", "at the airport"], ["na dworcu", "at the station"], ["w kinie", "in the cinema"], ["w restauracji", "in the restaurant"], ["na uczelni", "at the college"], ["o filmie", "about the film"], ["o pracy", "about work"], ["po obiedzie", "after lunch"], ["po lekcjach", "after classes"], ["na wakacjach", "on holiday"], ["w mieszkaniu", "in the flat"], ["w nowym domu", "in the new house"], ["na ulicy", "on the street"]], "grammar": "<b>Locative:</b> after <i>w, na, o, po</i>; adjectives agree: <i>w nowym domu</i>.", "dialogues": [{"npc": "Recepcja", "q": "Gdzie mieszkasz?", "answers": [["Mieszkam w Warszawie.", 1], ["Mieszkam Warszawa.", 0], ["Na Warszawie.", 0]]}, {"npc": "Znajomy", "q": "O czym rozmawiacie?", "answers": [["O pracy i filmach.", 1], ["Do pracy.", 0], ["Pod pracÄ….", 0]]}]}, {"id": 13, "level": "B1", "title": "Health & Doctor Visit", "topics": ["symptoms", "advice", "imperative", "pharmacy"], "vocab": [["bÃ³l gÅ‚owy", "headache"], ["gorÄ…czka", "fever"], ["bÃ³l gardÅ‚a", "sore throat"], ["kaszel", "cough"], ["katar", "runny nose"], ["osÅ‚abienie", "weakness"], ["dreszcze", "shivers"], ["mdÅ‚oÅ›ci", "nausea"], ["alergia", "allergy"], ["wysypka", "rash"], ["tabletki", "tablets"], ["syrop", "syrup"], ["antybiotyk", "antibiotic"], ["recepta", "prescription"], ["zwolnienie lekarskie", "sick leave"], ["umÃ³wiÄ‡ wizytÄ™", "make an appointment"], ["przyjÄ…Ä‡ pacjenta", "admit a patient"], ["badanie", "examination"], ["ciÅ›nienie", "blood pressure"], ["temperatura", "temperature"], ["zalecenia", "recommendations"], ["odpoczynek", "rest"], ["duÅ¼o piÄ‡", "drink a lot"], ["unikaÄ‡ wysiÅ‚ku", "avoid effort"], ["ProszÄ™ gÅ‚Ä™boko oddychaÄ‡.", "Please breathe deeply."], ["Czy jest pan/pani uczulony?", "Are you allergic?"], ["ProszÄ™ przyjmowaÄ‡ lek dwa razy dziennie.", "Please take the medicine twice a day."]], "grammar": "<b>At the doctor:</b> describe symptoms; use polite imperative: <i>ProszÄ™â€¦</i>.", "dialogues": [{"npc": "Lekarz", "q": "Jakie ma pan/pani objawy?", "answers": [["Boli mnie gardÅ‚o i mam gorÄ…czkÄ™.", 1], ["Mam biblioteka.", 0], ["Czerwony autobus.", 0]]}, {"npc": "Farmaceuta", "q": "Czy ma pan/pani receptÄ™?", "answers": [["Tak, tutaj.", 1], ["Jutro rano.", 0], ["DziÄ™kujÄ™ bardzo.", 0]]}]}, {"id": 14, "level": "B1", "title": "Work & Job Applications", "topics": ["CV", "interview", "workplace", "formal"], "vocab": [["stanowisko", "position"], ["doÅ›wiadczenie", "experience"], ["obowiÄ…zki", "duties"], ["umiejÄ™tnoÅ›ci", "skills"], ["kwalifikacje", "qualifications"], ["umowa", "contract"], ["umowa o pracÄ™", "employment contract"], ["umowa zlecenie", "mandate contract"], ["wynagrodzenie", "salary"], ["premia", "bonus"], ["list motywacyjny", "cover letter"], ["Å¼yciorys", "resume/CV"], ["ogÅ‚oszenie o pracÄ™", "job ad"], ["rekrutacja", "recruitment"], ["rozmowa kwalifikacyjna", "job interview"], ["awans", "promotion"], ["szkolenie", "training"], ["zespÃ³Å‚", "team"], ["termin", "deadline"], ["spotkanie", "meeting"], ["zdalnie", "remotely"], ["na peÅ‚en etat", "fullâ€‘time"], ["Czy moÅ¼emy umÃ³wiÄ‡ siÄ™ na rozmowÄ™?", "Can we schedule an interview?"], ["W zaÅ‚Ä…czeniu przesyÅ‚am CV.", "I attach my CV."], ["zakres obowiÄ…zkÃ³w", "scope of duties"], ["dojazd do pracy", "commute to work"], ["grafik", "schedule"], ["praca zmianowa", "shift work"], ["elastyczne godziny", "flexible hours"]], "grammar": "<b>Formal eâ€‘mail:</b> <i>W zaÅ‚Ä…czeniu przesyÅ‚am CV. Czy moÅ¼emy umÃ³wiÄ‡ siÄ™ na rozmowÄ™?</i>.", "dialogues": [{"npc": "Rekruter", "q": "Dlaczego chce pan/pani u nas pracowaÄ‡?", "answers": [["Mam doÅ›wiadczenie i lubiÄ™ wyzwania.", 1], ["LubiÄ™ jabÅ‚ka.", 0], ["Nie chcÄ™ pracy.", 0]]}, {"npc": "Szef", "q": "Czy pasuje jutro o 10:00?", "answers": [["Tak, dziÄ™kujÄ™ za zaproszenie.", 1], ["Do widzenia.", 0], ["Jutro wczoraj.", 0]]}]}, {"id": 15, "level": "B1", "title": "Housing & Real Estate", "topics": ["renting", "problems", "complaints", "contracts"], "vocab": [["wynajem", "renting"], ["mieszkanie", "apartment"], ["pokÃ³j", "room"], ["kaucja", "deposit"], ["czynsz", "rent (payment)"], ["umowa najmu", "rental agreement"], ["wspÃ³Å‚lokator", "flatmate"], ["spÃ³Å‚dzielnia", "housing association"], ["administracja", "administration"], ["usterka", "fault"], ["awaria", "breakdown"], ["zgÅ‚osiÄ‡ problem", "report a problem"], ["naprawa", "repair"], ["grzejnik", "radiator"], ["ogrzewanie", "heating"], ["ciepÅ‚a woda", "hot water"], ["winda", "elevator"], ["domofon", "intercom"], ["odczyt licznikÃ³w", "meter reading"], ["protokÃ³Å‚ zdawczoâ€‘odbiorczy", "handover protocol"], ["mieszkanie do wynajÄ™cia", "flat for rent"], ["ogÅ‚oszenie", "advert"], ["media", "utilities"], ["termin wypowiedzenia", "notice period"], ["odbiÃ³r kluczy", "key pickup"], ["zastaw", "deposit/pledge"], ["stan techniczny", "technical condition"], ["spis wyposaÅ¼enia", "inventory list"]], "grammar": "<b>Complaint:</b> <i>ZgÅ‚aszam problem z ogrzewaniem. ProszÄ™ o naprawÄ™ do piÄ…tku.</i>.", "dialogues": [{"npc": "WÅ‚aÅ›ciciel", "q": "Czy podpisujemy umowÄ™?", "answers": [["Tak, ale proszÄ™ wyjaÅ›niÄ‡ wysokoÅ›Ä‡ kaucji.", 1], ["Nie mam czasu i kot.", 0], ["Chleb jest tani.", 0]]}, {"npc": "Administrator", "q": "Co dokÅ‚adnie nie dziaÅ‚a?", "answers": [["Klimatyzacja nie chÅ‚odzi i winda siÄ™ zacina.", 1], ["LubiÄ™ lody.", 0], ["Tak, proszÄ™.", 0]]}]}, {"id": 16, "level": "B1", "title": "Banking & Public Services", "topics": ["bank", "post", "utilities", "formalities"], "vocab": [["bankomat", "ATM"], ["konto", "account"], ["rachunek bankowy", "bank account"], ["przelew", "transfer"], ["zlecenie staÅ‚e", "standing order"], ["karta debetowa", "debit card"], ["karta kredytowa", "credit card"], ["prowizja", "fee/commission"], ["saldo", "balance"], ["wpÅ‚ata", "deposit"], ["wypÅ‚ata", "withdrawal"], ["wniosek", "application form"], ["formularz", "form"], ["dowÃ³d osobisty", "ID card"], ["paszport", "passport"], ["urzÄ™dnik", "clerk"], ["urzÄ…d", "office"], ["poczta", "post office"], ["list polecony", "registered letter"], ["przesyÅ‚ka", "parcel"], ["rachunek", "bill/invoice"], ["opÅ‚ata", "payment/fee"], ["termin pÅ‚atnoÅ›ci", "due date"], ["odsetki", "interest"], ["zaÅ›wiadczenie", "certificate"], ["zaÅ‚Ä…cznik", "attachment"], ["pieczÄ…tka", "stamp"], ["kolejka", "queue"], ["okienko", "counter window"], ["numer sprawy", "case number"]], "grammar": "<b>Formalities:</b> <i>ChciaÅ‚bym otworzyÄ‡ konto. Jakie dokumenty sÄ… potrzebne?</i>.", "dialogues": [{"npc": "Bank", "q": "W czym mogÄ™ pomÃ³c?", "answers": [["ChciaÅ‚bym zrobiÄ‡ przelew zagraniczny.", 1], ["PoproszÄ™ kawÄ™.", 0], ["Gdzie dworzec?", 0]]}, {"npc": "UrzÄ™dnik", "q": "Brakuje jednego dokumentu.", "answers": [["Czy mogÄ™ dosÅ‚aÄ‡ zaÅ›wiadczenie mailem?", 1], ["Tak, jabÅ‚ko.", 0], ["Nie chcÄ™.", 0]]}]}, {"id": 17, "level": "B1", "title": "Travel & Accommodation (Advanced)", "topics": ["hotel", "complaints", "reservations", "air travel"], "vocab": [["rezerwacja", "reservation"], ["potwierdzenie rezerwacji", "reservation confirmation"], ["zameldowanie", "checkâ€‘in"], ["wymeldowanie", "checkâ€‘out"], ["pokÃ³j dwuosobowy", "double room"], ["pokÃ³j jednoosobowy", "single room"], ["klimatyzacja", "air conditioning"], ["Å›niadanie w cenie", "breakfast included"], ["opÅ‚ata za noc", "nightly fee"], ["opÅ‚ata uzdrowiskowa", "city tax"], ["usÅ‚uga", "service"], ["dodatkowa poduszka", "extra pillow"], ["proÅ›ba o cichy pokÃ³j", "request for a quiet room"], ["reklamacja", "complaint"], ["odszkodowanie", "compensation"], ["lotnisko", "airport"], ["odprawa", "checkâ€‘in (airport)"], ["kontrola bezpieczeÅ„stwa", "security check"], ["bramka", "gate"], ["przyloty", "arrivals"], ["odloty", "departures"], ["bagaÅ¼ rejestrowany", "checked baggage"], ["bagaÅ¼ podrÄ™czny", "hand luggage"], ["opÃ³Åºniony lot", "delayed flight"], ["odwoÅ‚any lot", "cancelled flight"], ["przesiadka", "layover/transfer"], ["czy mogliby PaÅ„stwoâ€¦", "could you pleaseâ€¦"], ["chciaÅ‚bym zmieniÄ‡ pokÃ³j", "Iâ€™d like to change the room"], ["zatwierdziÄ‡ pÅ‚atnoÅ›Ä‡", "to approve payment"]], "grammar": "<b>Hotel:</b> uprzejme proÅ›by: <i>Czy mogliby PaÅ„stwoâ€¦</i>.", "dialogues": [{"npc": "Recepcja", "q": "Czy wszystko w porzÄ…dku?", "answers": [["Niestety, klimatyzacja nie dziaÅ‚a.", 1], ["Jestem jabÅ‚kiem.", 0], ["Jutro wczoraj.", 0]]}, {"npc": "Agent linii", "q": "Lot jest opÃ³Åºniony o dwie godziny.", "answers": [["Czy mogÄ™ dostaÄ‡ voucher na posiÅ‚ek?", 1], ["DziÄ™kujÄ™, do widzenia.", 0], ["Nie ma problemu.", 0]]}]}, {"id": 18, "level": "B1", "title": "Emergencies, Society & Opinions", "topics": ["112", "documents", "opinions", "linkers"], "vocab": [["wypadek", "accident"], ["awaria", "breakdown"], ["poÅ¼ar", "fire"], ["pogotowie", "ambulance (service)"], ["policja", "police"], ["zgubiÄ‡ dokumenty", "to lose documents"], ["kradzieÅ¼", "theft"], ["Å›wiadek", "witness"], ["zeznanie", "testimony"], ["ubezpieczenie", "insurance"], ["mandat", "fine"], ["dowÃ³d osobisty", "ID card"], ["prawo jazdy", "driverâ€™s license"], ["paszport", "passport"], ["uwaÅ¼am, Å¼e", "I think that"], ["moim zdaniem", "in my opinion"], ["poniewaÅ¼", "because"], ["dlatego", "therefore"], ["chociaÅ¼", "although"], ["jednak", "however"], ["z jednej stronyâ€¦ z drugiej stronyâ€¦", "on one handâ€¦ on the other handâ€¦"], ["jestem za", "Iâ€™m in favor"], ["jestem przeciw", "Iâ€™m against"], ["przykÅ‚ad", "example"], ["rozwiÄ…zanie", "solution"], ["zgÅ‚osiÄ‡ na policjÄ™", "report to the police"], ["zadzwoniÄ‡ pod 112", "call 112"], ["usunÄ…Ä‡ usterkÄ™", "remove the fault"]], "grammar": "<b>Emergencies:</b> present facts clearly; Opinions: linkers <i>poniewaÅ¼, dlatego, chociaÅ¼</i>.", "dialogues": [{"npc": "Policjant", "q": "Co siÄ™ staÅ‚o?", "answers": [["ZgubiÅ‚em dokumenty, potrzebujÄ™ pomocy.", 1], ["LubiÄ™ muzykÄ™ i...", 0], ["ChcÄ™ chleb.", 0]]}, {"npc": "UrzÄ™dnik", "q": "Jaki jest pana/pani wniosek?", "answers": [["ChciaÅ‚bym zgÅ‚osiÄ‡ kradzieÅ¼ telefonu.", 1], ["ProszÄ™ paragon.", 0], ["Nie wiem.", 0]]}]}];

// ===== Utils =====
function el(tag, cls, html){ const e=document.createElement(tag); if(cls) e.className=cls; if(html!==undefined) e.innerHTML=html; return e;}
function screen(node){ const s=document.getElementById('screen'); s.innerHTML=''; s.appendChild(node); window.scrollTo({top:0, behavior:'smooth'}); }
function shuffle(a){ return a.map(v=>[Math.random(),v]).sort((a,b)=>a[0]-b[0]).map(x=>x[1]); }
function sample(a,n){ const c=[...a]; return shuffle(c).slice(0,n); }
function chips(v){ return v.slice(0,10).map(([pl,en])=>`<span class="pill" title="${en}">${pl}</span>`).join(' '); }

// Example sentence generator (simple heuristics)
function makeExample(pl, en){
  if(/\s/.test(pl)) return {pl:`${pl}.`, en:`${en}.`};
  const verbLike = /(Ä™|sz$|am$|asz$|isz$|ujÄ™$)/.test(pl);
  if(verbLike){ return {pl:`Ja ${pl} codziennie.`, en:`I ${en} every day.`}; }
  return {pl:`To jest ${pl}.`, en:`This is ${en}.`};
}

// ===== Home (with level gating) =====
function home(){
  Save.touchStreak();
  const wrap = el('div','');
  wrap.appendChild(el('div','card',`
    <div class="h2">Your pathway</div>
    <div class="subtle">Complete all A1 units to unlock A2. Complete all A2 to unlock B1. XP and review are saved locally.</div>
  `));

  const groups = ['A1','A2','B1'];
  const a1Complete = COURSE.filter(x=>x.level==='A1').every(x=>Save.data.unitsDone[x.id]);
  const a2Complete = COURSE.filter(x=>x.level==='A2').every(x=>Save.data.unitsDone[x.id]);
  groups.forEach(L=>{
    const grid = el('div','grid');
    wrap.appendChild(el('div','level-banner',`Level ${L}`));
    COURSE.filter(u=>u.level===L).forEach(u=>{
      const done = !!Save.data.unitsDone[u.id];
      const card = el('div','card');
      card.innerHTML = `
        <div class="subtle">Unit ${u.id}</div>
        <div class="h3">${u.title}</div>
        <div class="subtle">Topics: ${u.topics.join(', ')}</div>
        <div style="margin:8px 0">${chips(u.vocab)}</div>
        <div class="row">
          <button class="btn" data-id="${u.id}">${done?'âœ… Review / Replay':'â–¶ï¸ Start'}</button>
          <span class="pill">${done?'Completed':'Not started'}</span>
        </div>`;
      let locked=false, reason='';
      if(u.level==='A2' && !a1Complete){ locked=true; reason='Complete all A1 units to unlock A2.'; }
      if(u.level==='B1' && !a2Complete){ locked=true; reason='Complete all A2 units to unlock B1.'; }
      if(locked){
        const overlay = el('div','lock',`ğŸ”’ ${reason}`);
        card.appendChild(overlay);
        card.querySelector('button').disabled = true;
      }else{
        card.querySelector('button').onclick=()=>unit(u.id);
      }
      grid.appendChild(card);
    });
    wrap.appendChild(grid);
  });

  const extras = el('div','grid');
  const reviewCard = el('div','card',`<div class="h3">Spaced Review</div><p>Practice your recent mistakes.</p><button class="btn" id="goReview">ğŸ“š Review now</button>`);
  reviewCard.querySelector('#goReview').onclick=()=>review();
  const examCard = el('div','card',`<div class="h3">B1 Mock Exam</div><p>Full simulation with instant feedback.</p><button class="btn" id="goExam">ğŸ“ Start exam</button>`);
  examCard.querySelector('#goExam').onclick=()=>mockExam();
  extras.appendChild(reviewCard); extras.appendChild(examCard);
  wrap.appendChild(extras);
  screen(wrap);
}
document.getElementById('resetBtn').onclick=()=>{ if(confirm('Reset all progress?')){ localStorage.removeItem(SAVE_KEY); Save.load(); home(); } };
document.getElementById('reviewBtn').onclick=()=>review();
document.getElementById('examBtn').onclick=()=>mockExam();

// ===== Study Materials (Extended) =====
function studyMaterials(u, onStart){
  const wrap = el('div','card');
  const list = el('div','list');
  const top = el('div','topbar');
  const homeBtn = el('button','btn small','ğŸ  Home');
  homeBtn.onclick=()=>home();
  top.appendChild(el('div', null, `<div class="h2">Study Materials â€” Unit ${u.id}: ${u.title}</div><div class="subtle">Tap ğŸ”ˆ to hear words and example sentences.</div>`));
  top.appendChild(homeBtn);
  wrap.appendChild(top);

  // Full vocabulary with audio and example + English
  u.vocab.forEach(([pl,en], idx)=>{
    const ex = makeExample(pl,en);
    const row = el('div','card',
      `<div class="h3"><span class="pill">${pl}</span> <span class="subtle">â€” ${en}</span></div>
       <div class="row">
         <button class="btn small" id="say_word_${idx}">ğŸ”ˆ Word</button>
         <button class="btn small" id="say_ex_${idx}">ğŸ”ˆ Example</button>
       </div>
       <div class="subtle">PL: ${ex.pl}</div>
       <div class="subtle">EN: ${ex.en}</div>`
    );
    list.appendChild(row);
    setTimeout(()=>{
      row.querySelector(`#say_word_${idx}`).onclick=()=>speak(pl);
      row.querySelector(`#say_ex_${idx}`).onclick=()=>speak(ex.pl);
    });
  });

  const ops = el('div','row');
  const startBtn = el('button','btn','Start unit');
  const skipBtn  = el('button','btn small','Skip study');
  startBtn.onclick=onStart; skipBtn.onclick=onStart;
  ops.appendChild(startBtn); ops.appendChild(skipBtn);

  wrap.appendChild(list);
  wrap.appendChild(ops);
  screen(wrap);
}

// ===== Unit engine =====
function unit(id){
  const u = COURSE.find(x=>x.id===id);
  // First show study materials
  studyMaterials(u, startActivities);
  function startActivities(){
    const wrap = el('div','');
    const top = el('div','topbar');
    const homeBtn = el('button','btn small','ğŸ  Home');
    homeBtn.onclick=()=>home();
    top.appendChild(el('div', null, `<div class="h2">Unit ${u.id} â€” ${u.title} <span class="pill">Level ${u.level}</span></div>
       <div class="subtle">Activities: Flashcards â†’ Multiple Choice â†’ Cloze â†’ Dialogue â†’ Listening â†’ Speaking â†’ Writing</div>`));
    top.appendChild(homeBtn);
    wrap.appendChild(top);
    wrap.appendChild(el('div','card',`<div class="progress" style="margin-top:6px"><div id="uBar"></div></div>`));

    const stages = [
      ()=>activityFlashcards(u,next),
      ()=>activityMC(u,next),
      ()=>activityCloze(u,next),
      ()=>activityDialogue(u,next),
      ()=>activityListening(u,next),
      ()=>activitySpeaking(u,next),
      ()=>activityWriting(u,finish)
    ];
    let step=0;
    function next(){ step++; updateBar(); stages[step](); }
    function finish(){ Save.markUnit(u.id); Save.addXP(150); endUnit(u); }
    function updateBar(){ document.getElementById('uBar').style.width = Math.round(step/stages.length*100)+'%'; }
    updateBar(); stages[0]();
    screen(wrap);
  }
}
function endUnit(u){
  const wrap=el('div','card center');
  wrap.innerHTML = `<div class="h2">Unit ${u.id} complete!</div><p>+150 XP</p>
  <div class="row" style="justify-content:center">
    <button class="btn" id="home">ğŸ  Home</button>
    <button class="btn" id="review">Review mistakes</button>
  </div>`;
  wrap.querySelector('#home').onclick=()=>home();
  wrap.querySelector('#review').onclick=()=>review();
  screen(wrap);
}

// ===== Activities (with Skip buttons) =====
function activityFlashcards(u,done){
  const cont = el('div','card');
  cont.innerHTML = `<div class="h3">Flashcards â€” Type the meaning</div>`;
  const list = shuffle(u.vocab).slice(0, Math.min(15, u.vocab.length));
  let i=0, good=0;
  const q = el('div','row'); cont.appendChild(q);
  const input = el('input'); input.placeholder='Meaning in Englishâ€¦';
  const btn = el('button','btn small','Check');
  const skip = el('button','btn small','Skip');
  const hint = el('div','subtle');
  function render(){ const [pl,en]=list[i]; q.innerHTML=`<span class="pill">${pl}</span>`; q.appendChild(soundBtn(pl)); input.value=''; hint.textContent=''; }
  function advance(skipped=false){ i++; if(i>=list.length){ cont.appendChild(el('hr')); cont.appendChild(el('div',null,`Score: ${good}/${list.length}`)); const k=el('button','btn','Continue'); k.onclick=done; cont.appendChild(k);} else render(); if(skipped){ Save.pushReview({type:'vocab',pl:list[i-1][0],en:list[i-1][1]}); } }
  btn.onclick=()=>{ const [pl,en]=list[i]; if(input.value.trim().toLowerCase()===en.toLowerCase()){ good++; Save.addXP(5); hint.innerHTML='<span class="primary">âœ“</span>'; } else { hint.innerHTML=`<span class="danger">âœ— ${en}</span>`; Save.pushReview({type:'vocab',pl,en}); } advance(false); };
  skip.onclick=()=>advance(true);
  input.addEventListener('keydown',e=>{ if(e.key==='Enter') btn.click(); });
  cont.appendChild(input); cont.appendChild(btn); cont.appendChild(skip); cont.appendChild(hint);
  cont.appendChild(el('hr')); cont.appendChild(el('div','subtle',u.grammar));
  screen(cont);
}

function activityMC(u,done){
  const cont = el('div','card'); cont.innerHTML='<div class="h3">Multiple choice â€” pick the meaning</div>';
  const pool = shuffle(u.vocab); let i=0, score=0;
  const list=el('div','list'); cont.appendChild(list);
  const ops=el('div','sticky-ops'); const home=el('button','btn small','ğŸ  Home'); home.onclick=()=>home(); const skip=el('button','btn small','Skip'); cont.appendChild(ops); ops.appendChild(home); ops.appendChild(skip);
  function render(){ const [pl,en]=pool[i]; list.innerHTML=''; const q=el('div','row',`<span class="pill">${pl}</span>`); q.appendChild(soundBtn(pl)); list.appendChild(q);
    const opts = shuffle([en, ...sample(pool.filter(p=>p[1]!==en).map(x=>x[1]),3)]);
    opts.forEach(o=>{ const b=el('button','choice',o); b.onclick=()=>{ if(o===en){ b.classList.add('correct'); score++; Save.addXP(5);} else { b.classList.add('wrong'); Save.pushReview({type:'vocab',pl,en}); } [...list.querySelectorAll('.choice')].forEach(x=>x.disabled=true); setTimeout(()=>advance(false),360); }; list.appendChild(b); });
  }
  function advance(skipped){ i++; if(i>=Math.min(pool.length,12)){ cont.appendChild(el('hr')); cont.appendChild(el('div',null,`Score: ${score}/${Math.min(pool.length,12)}`)); const k=el('button','btn','Continue'); k.onclick=done; cont.appendChild(k);} else render(); if(skipped){ const [pl,en]=pool[i-1]; Save.pushReview({type:'vocab',pl,en}); } }
  skip.onclick=()=>advance(true);
  render(); screen(cont);
}

function activityCloze(u,done){
  const templates = [
    ['PoproszÄ™ __.', 'chleb', 'PoproszÄ™ chleb.'],
    ['Mieszkam __ Warszawie.', 'w', 'Mieszkam w Warszawie.'],
    ['Nie mam __.', 'czasu', 'Nie mam czasu.'],
    ['DziÄ™kujÄ™ __ pomoc.', 'za', 'DziÄ™kujÄ™ za pomoc.'],
    ['IdÅº __ prawo i potem prosto.', 'w', 'IdÅº w prawo i potem prosto.'],
    ['SÅ‚ucham __ wieczorem.', 'muzyki', 'SÅ‚ucham muzyki wieczorem.'],
    ['Pomagam __ bratu.', 'mojemu', 'Pomagam mojemu bratu.']
  ];
  const deck = shuffle(templates).slice(0,7); let i=0, good=0;
  const cont=el('div','card'); const input=el('input'); input.placeholder='Missing wordâ€¦'; const hint=el('div','subtle'); const btn=el('button','btn small','Check'); const skip=el('button','btn small','Skip');
  const ops=el('div','row'); const home=el('button','btn small','ğŸ  Home'); home.onclick=()=>home(); ops.appendChild(home);
  function render(){ const [q,a,full]=deck[i]; cont.innerHTML=`<div class="h3">Cloze â€” Fill the gap</div><div class="pill">${q}</div>`; cont.appendChild(ops); cont.appendChild(input); cont.appendChild(btn); cont.appendChild(skip); cont.appendChild(hint); input.value=''; hint.textContent=''; }
  function advance(skipped){ i++; if(i>=deck.length){ cont.appendChild(el('hr')); cont.appendChild(el('div',null,`Score: ${good}/${deck.length}`)); const k=el('button','btn','Continue'); k.onclick=done; cont.appendChild(k);} else render(); if(skipped){ const [q,a]=deck[i-1]; Save.pushReview({type:'cloze',q:q,ans:a}); } }
  btn.onclick=()=>{ const [q,a,full]=deck[i]; if(input.value.trim().toLowerCase()===a.toLowerCase()){ good++; Save.addXP(6); hint.innerHTML='<span class="primary">âœ“</span> '+full; } else { hint.innerHTML='<span class="danger">âœ—</span> '+full; Save.pushReview({type:'cloze',q,ans:a}); } setTimeout(()=>advance(false),360); };
  skip.onclick=()=>advance(true);
  render(); screen(cont);
}

function activityDialogue(u,done){
  const cont=el('div','card'); cont.appendChild(el('div','h3','Dialogue â€” choose the reply'));
  let i=0; const ops=el('div','sticky-ops'); const home=el('button','btn small','ğŸ  Home'); home.onclick=()=>home(); const skip=el('button','btn small','Skip'); ops.appendChild(home); ops.appendChild(skip); cont.appendChild(ops);
  function render(){ const turn=u.dialogues[i]; const body=el('div','list'); cont.insertBefore(body, ops); body.innerHTML=''; const prompt=el('div','row',`<div class="pill"><b>${turn.npc}:</b> ${turn.q}</div>`); body.appendChild(prompt); const choices=el('div','list'); body.appendChild(choices); shuffle(turn.answers).forEach(([txt,ok])=>{ const b=el('button','choice',txt); b.appendChild(soundBtn(txt)); b.onclick=()=>{ if(ok){ b.classList.add('correct'); Save.addXP(8); speak(txt);} else { b.classList.add('wrong'); Save.pushReview({type:'dialogue',q:turn.q,txt}); } [...choices.children].forEach(x=>x.disabled=true); setTimeout(()=>advance(false),460); }; choices.appendChild(b); }); }
  function advance(skipped){ i++; if(i>=u.dialogues.length){ cont.appendChild(el('hr')); const k=el('button','btn','Continue'); k.onclick=done; cont.appendChild(k);} else render(); if(skipped){ Save.pushReview({type:'dialogue-skip',q:u.dialogues[i-1].q}); } }
  skip.onclick=()=>advance(true);
  render(); screen(cont);
}

function activityListening(u,done){
  const cont=el('div','card'); cont.innerHTML='<div class="h3">Listening â€” play, then answer</div>'; const passage = buildListening(u); const play=el('button','btn small','â–¶ï¸ Play'); play.onclick=()=>speak(passage.text); cont.appendChild(play); cont.appendChild(el('div','subtle',passage.text));
  passage.qs.forEach(q=>{ cont.appendChild(el('div','pill',q.q)); const options=el('div','list'); shuffle(q.options).forEach(o=>{ const b=el('button','choice',o); b.onclick=()=>{ if(o===q.answer){ b.classList.add('correct'); Save.addXP(7);} else { b.classList.add('wrong'); Save.pushReview({type:'listening',q:q.q,ans:q.answer}); } [...options.children].forEach(x=>x.disabled=true); }; options.appendChild(b); }); cont.appendChild(options); cont.appendChild(el('hr')); });
  const ops=el('div','row'); const home=el('button','btn small','ğŸ  Home'); home.onclick=()=>home(); const skip=el('button','btn small','Skip section'); const next=el('button','btn','Continue'); skip.onclick=()=>done(); next.onclick=()=>done(); ops.appendChild(home); ops.appendChild(skip); ops.appendChild(next); cont.appendChild(ops);
  screen(cont);
}
function buildListening(u){ const who=['Kasia','Adam','Ewa','Piotr'][Math.floor(Math.random()*4)]; const city=['Warszawie','Krakowie','GdaÅ„sku'][Math.floor(Math.random()*3)]; const topic = u.level==='B1' ? 'spotkanie w urzÄ™dzie' : 'zakupy w sklepie'; const text = `${who} ma ${topic} w ${city}. Prosi o pomoc i dziÄ™kuje. Potem wraca do domu.`; return { text, qs:[ {q:'W jakim mieÅ›cie jest wydarzenie?', options:['w Warszawie','w Krakowie','w GdaÅ„sku'], answer:'w '+city}, {q:'Co robi bohater/bohaterka?', options:['ma spotkanie','idzie spaÄ‡','biega maraton'], answer:'ma spotkanie'} ] }; }

function activitySpeaking(u,done){
  const cont=el('div','card'); cont.innerHTML=`<div class="h3">Speaking â€” say the line</div><p class="subtle">Click â€œğŸ™ï¸ Startâ€ and say the sentence. Weâ€™ll detect key words (browser support varies).</p>`; const target = u.dialogues[0]?.answers.find(x=>x[1])[0] || (u.vocab[0]?u.vocab[0][0]:'DzieÅ„ dobry.'); const show=el('div','row',`<div class="pill">${target}</div>`); show.appendChild(soundBtn(target)); cont.appendChild(show); const out=el('div','subtle','â€”'); const start=el('button','btn small','ğŸ™ï¸ Start'); const home=el('button','btn small','ğŸ  Home'); home.onclick=()=>home(); const skip=el('button','btn small','Skip');
  let recog, ok=false; start.onclick=()=>{ const R=window.SpeechRecognition||window.webkitSpeechRecognition; if(!R){ alert('Speech recognition not supported on this browser.'); return; } recog=new R(); recog.lang='pl-PL'; recog.interimResults=true; recog.onresult=e=>{ const txt=Array.from(e.results).map(r=>r[0].transcript).join(' '); out.textContent=txt; if(!ok && txt.toLowerCase().includes(target.split(' ')[0].toLowerCase())){ ok=true; Save.addXP(10); out.innerHTML+=' <span class="primary">âœ“</span>'; } }; recog.start(); };
  skip.onclick=()=>done();
  const controls=el('div','row'); controls.appendChild(start); controls.appendChild(skip); controls.appendChild(home); const next=el('button','btn','Continue'); next.onclick=done; controls.appendChild(next); cont.appendChild(controls); cont.appendChild(out);
  cont.appendChild(el('hr')); screen(cont);
}

function activityWriting(u,done){
  const cont=el('div','card'); const prompt = pickPrompt(u); cont.innerHTML = `<div class="h3">Writing â€” short text</div><p class="subtle">Write ${prompt.min}-${prompt.max} words. Include: <b>${prompt.must.join(', ')}</b>.</p>`; const ta=el('textarea'); const info=el('div','subtle'); const btn=el('button','btn small','Check & finish'); const skip=el('button','btn small','Skip'); const home=el('button','btn small','ğŸ  Home'); home.onclick=()=>home();
  btn.onclick=()=>{ const text=ta.value.trim(); const words=text.split(/\\s+/).filter(Boolean); const missing=prompt.must.filter(k=>!text.toLowerCase().includes(k.toLowerCase())); let msg='Words: '+words.length+'. '; if(words.length<prompt.min || words.length>prompt.max){ msg+=`<span class="warning">Aim ${prompt.min}-${prompt.max}.</span> `; } else msg+='<span class="primary">Good length.</span> '; if(missing.length){ msg+= 'Missing: <b>'+missing.join(', ')+'</b>'; Save.pushReview({type:'writing',missing,topic:prompt.title}); } else { msg+='<span class="primary">All included.</span>'; Save.addXP(15); done(); } info.innerHTML=msg; };
  skip.onclick=()=>done();
  const ops=el('div','row'); ops.appendChild(btn); ops.appendChild(skip); ops.appendChild(home);
  cont.appendChild(ta); cont.appendChild(ops); cont.appendChild(info); screen(cont);
}
function pickPrompt(u){ const base=[ {title:'E-mail do znajomego o weekendzie (miejsce, osoby, opinia).', must:['w weekend','byÅ‚em','byÅ‚am','uwaÅ¼am'], min:80, max:140}, {title:'Skarga do hotelu: problem i propozycja rozwiÄ…zania.', must:['problem','proszÄ™','naprawiÄ‡'], min:100, max:160}, {title:'CV â€” krÃ³tki opis doÅ›wiadczenia i umiejÄ™tnoÅ›ci.', must:['doÅ›wiadczenie','umiejÄ™tnoÅ›ci','pracowaÅ‚em','pracowaÅ‚am'], min:100, max:160}, {title:'Wizyta u lekarza â€” opisz objawy i zalecenia.', must:['boli','gorÄ…czka','proszÄ™'], min:90, max:150} ]; return base[Math.floor(Math.random()*base.length)]; }
function newRow(){ const d=el('div','row'); [...arguments].forEach(a=>d.appendChild(a)); return d; }

// ===== Review =====
function review(){ const items=Save.data.review.slice(-30); const wrap=el('div','card'); wrap.innerHTML='<div class="h3">Spaced Review</div>'; if(!items.length){ wrap.appendChild(el('div',null,'No items yet. Complete units first.')); screen(wrap); return; } let i=0,sc=0; function render(){ const it=items[i]; wrap.innerHTML='<div class="h3">Spaced Review</div>'; if(it.type==='vocab'){ const q=el('div','row',`<div class="pill">${it.pl}</div>`); q.appendChild(soundBtn(it.pl)); wrap.appendChild(q); const input=el('input'); input.placeholder='Meaning in Englishâ€¦'; const b=el('button','btn small','Check'); b.onclick=()=>{ if(input.value.trim().toLowerCase()===(it.en||'').toLowerCase()){ sc++; Save.addXP(4);} next(); }; wrap.appendChild(input); wrap.appendChild(b); } else if(it.type==='cloze'){ wrap.appendChild(el('div','pill',it.q)); const input=el('input'); const b=el('button','btn small','Check'); b.onclick=()=>{ if(input.value.trim().toLowerCase()===(it.ans||'').toLowerCase()){ sc++; Save.addXP(4);} next(); }; wrap.appendChild(input); wrap.appendChild(b); } else { const t=it.txt||it.ans||it.en||''; const row=el('div','row',`<div class="pill">${t}</div>`); row.appendChild(soundBtn(t)); wrap.appendChild(row); const k=el('button','btn small','I said it'); k.onclick=()=>{ sc++; Save.addXP(4); next(); }; wrap.appendChild(k);} } function next(){ i++; if(i>=items.length){ wrap.appendChild(el('hr')); wrap.appendChild(el('div',null,`Done: ${sc}/${items.length}`)); const h=el('button','btn','Home'); h.onclick=()=>home(); wrap.appendChild(h);} else render(); } render(); screen(wrap); }

// ===== Mock Exam =====
function mockExam(){ const wrap=el('div',''); const top = el('div','topbar'); const homeBtn=el('button','btn small','ğŸ  Home'); homeBtn.onclick=()=>home(); top.appendChild(el('div', null, `<div class="h2">Mock Exam</div>`)); top.appendChild(homeBtn); wrap.appendChild(top);
  const parts=['Reading','Listening','Writing','Speaking']; let step=0,score=0; function next(){ step++; if(step>=parts.length){ finish(); } else render(); } function render(){ if(step===0) examReading(()=>{score+=20; next();}, next, wrap); else if(step===1) examListening(()=>{score+=20; next();}, next, wrap); else if(step===2) examWriting(()=>{score+=20; next();}, next, wrap); else if(step===3) examSpeaking(()=>{score+=20; next();}, next, wrap); } function finish(){ const card=el('div','card center'); card.innerHTML=`<div class="h2">Mock Exam Completed</div><p>Sections cleared: <b>${score/20}/4</b>. This is an educational simulation.</p><div class="row center" style="justify-content:center"><button class="btn" id="goHome">ğŸ  Home</button></div>`; card.querySelector('#goHome').onclick=()=>home(); screen(card);} render(); }
function examReading(pass,fail,wrap){ const card=el('div','card'); const text='OgÅ‚oszenie: W sobotÄ™ odbÄ™dzie siÄ™ piknik rodzinny w parku miejskim. BÄ™dzie muzyka, gry dla dzieci i stoiska z jedzeniem. WstÄ™p wolny.'; card.innerHTML=`<div class="h3">Reading</div><p class="subtle">${text}</p>`; const qs=[{q:'Kiedy bÄ™dzie wydarzenie?',a:'sobotÄ™'},{q:'Gdzie odbÄ™dzie siÄ™ piknik?',a:'w parku'},{q:'Czy wstÄ™p jest pÅ‚atny?',a:'nie'}]; let correct=0; qs.forEach(o=>{ const inp=el('input'); inp.placeholder=o.q; inp.onchange=()=>{ if(inp.value.toLowerCase().includes(o.a)){ inp.style.outline='2px solid #22c55e'; correct++; } else { inp.style.outline='2px solid #ef4444'; } }; card.appendChild(inp); }); const btn=el('button','btn small','Submit'); const skip=el('button','btn small','Skip section'); btn.onclick=()=>{ if(correct>=2){ Save.addXP(25); pass(); } else fail(); }; skip.onclick=()=>pass(); card.appendChild(btn); card.appendChild(skip); wrap.appendChild(card); }
function examListening(pass,fail,wrap){ const card=el('div','card'); const text='DzieÅ„ dobry, pociÄ…g do Poznania odjedzie z peronu trzeciego o godzinie trzynastej trzydzieÅ›ci.'; card.innerHTML=`<div class="h3">Listening</div><button class="btn small" id="play">â–¶ï¸ Play</button>`; card.querySelector('#play').onclick=()=>speak(text); const q1=el('input'); q1.placeholder='Z ktÃ³rego peronu odjeÅ¼dÅ¼a pociÄ…g?'; const q2=el('input'); q2.placeholder='O ktÃ³rej godzinie?'; card.appendChild(q1); card.appendChild(q2); const btn=el('button','btn small','Submit'); const skip=el('button','btn small','Skip section'); btn.onclick=()=>{ const ok=q1.value.includes('trzec') && (q2.value.includes('13:30')||q2.value.includes('trzynastej')); if(ok){ Save.addXP(25); pass(); } else fail(); }; skip.onclick=()=>pass(); card.appendChild(btn); card.appendChild(skip); wrap.appendChild(card); }
function examWriting(pass,fail,wrap){ const card=el('div','card'); card.innerHTML='<div class="h3">Writing</div><p class="subtle">Napisz 100â€“160 sÅ‚Ã³w: e-mail do biura podrÃ³Å¼y z proÅ›bÄ… o informacje o wycieczce. Zadaj 3 pytania i przedstaw siebie.</p>'; const ta=el('textarea'); const ops=el('div','row'); const skip=el('button','btn small','Skip section'); const btn=el('button','btn small','Submit'); btn.onclick=()=>{ const wc=ta.value.trim().split(/\\s+/).filter(Boolean).length; if(wc>=100 && /\\?/.test(ta.value) && /nazywam|mam na imiÄ™|jestem/i.test(ta.value)){ Save.addXP(25); pass(); } else fail(); }; skip.onclick=()=>pass(); card.appendChild(ta); ops.appendChild(btn); ops.appendChild(skip); card.appendChild(ops); wrap.appendChild(card); }
function examSpeaking(pass,fail,wrap){ const card=el('div','card'); card.innerHTML='<div class="h3">Speaking</div><p class="subtle">Opowiedz o swoich planach na weekend (uÅ¼yj przyszÅ‚oÅ›ci).</p>'; const start=el('button','btn small','ğŸ™ï¸ Start'); const skip=el('button','btn small','Skip section'); const out=el('div','subtle','â€”'); let recog, hit=false; start.onclick=()=>{ const R=window.SpeechRecognition||window.webkitSpeechRecognition; if(!R){ alert('Speech recognition unsupported.'); return; } recog=new R(); recog.lang='pl-PL'; recog.interimResults=true; recog.onresult=e=>{ const txt=Array.from(e.results).map(r=>r[0].transcript).join(' '); out.textContent=txt; if(/bÄ™dÄ™|pÃ³jdÄ™|zrobiÄ™|przeczytam|obejrzÄ™/i.test(txt)) hit=true; }; recog.onend=()=>{ if(hit){ Save.addXP(25); pass(); } else fail(); }; recog.start(); }; skip.onclick=()=>pass(); card.appendChild(newRow(start, skip)); card.appendChild(out); wrap.appendChild(card); }

// ===== Init =====
Save.load(); home();
</script>

<script>
// Register service worker for offline use
if ('serviceWorker' in navigator) {
  window.addEventListener('load', function() {
    navigator.serviceWorker.register('./sw.js').catch(function(err){ console.warn('SW registration failed', err); });
  });
}
</script>

</body>
</html>
